import { Injectable } from '@angular/core';
import { Subject, Observable } from 'rxjs';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { I<%= name %>APIService } from './interfaces';
<%_ for( let imp of service.imports ){ _%>
import { <%= imp %> } from '../models';
<%_}_%>

@Injectable()
export class <%= name %>APIService implements I<%= name %>APIService {
    public serviceName: string;
    public uri: string;
    constructor(
        public http: HttpClient) {
        this.serviceName = '<%= name %>API';
        this.uri = '<%=service.uri%>';
    }
<% for(let method of service.methods){ %>
    /**
     * @method
     * @name  <%=method.name%>
     <%_ for(let param of method.params.all){_%>
     * @param {<%=param.type[0]%>} <%=param.name%>
     <%_}_%>
     */
    public <%=method.name%>(
        <%_ for(let i=0;i<method.params.all.length;i++){_%>
        <%=method.params.all[i].name%><%=method.params.all[i].required?'':'?'%>: <%=method.params.all[i].type[0]%><%=(i<method.params.all.length-1)?',':''%>
        <%_}_%>
    ): Observable<<%=method.resp.type%>> {
        const options = {
            headers: new HttpHeaders(),
            params: new HttpParams()};
        <%_ if(method.params.query.length!==0){_%>
        options.params = new HttpParams();
        <%_for(let query of method.params.query){_%>
        if (<%=query.name%> !== undefined) {
            options.params['<%=query.query_name%>'] = <%=query.name%>;
        }
        <%_}_%>
        <%_}_%>
        <%_ if((method.type==='post')||(method.type==='put')){ _%>
        <%_ if(method.params.form.length!==0) {_%>
        options.headers = new HttpHeaders();
        options.headers.delete('Content-Type');
        const form = new FormData();
        <%_for(let param of method.params.form){_%>
        form.append('<%=param.name%>', <%=param.name%>);
        <%_}_%>
        return this.http.<%=method.type%><<%=method.resp.type%>>(this.uri + `<%=method.uri%>`, form, options);
        <%_} else {_%>
        const payload = {};
        <%_for(let param of method.params.payload){_%>
        payload['<%=param.name%>'] = <%=param.name%>;
        <%_}_%>
        return this.http.<%=method.type%><<%=method.resp.type%>>(this.uri + `<%=method.uri%>`, JSON.stringify(payload)<%=method.params.query.length!==0?', options':''%>);
        <%_}_%>
        <%_}_%>

        <%_if((method.type==='get')||(method.type==='delete')){_%>
        return this.http.<%=method.type%><<%=method.resp.type%>>(this.uri + `<%=method.uri%>`<%=method.params.query.length!==0?', options':''%>);
        <%_}_%>
    }<%}%>

}
